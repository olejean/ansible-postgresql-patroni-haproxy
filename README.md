# Ansible PostgreSQL Patroni HAProxy

Проект по установке и настройке PostgreSQL с использованием Patroni, Etcd, HAProxy и Keepalived.

## Описание

Этот проект автоматизирует установку и настройку кластера PostgreSQL с высокой доступностью, используя следующие инструменты:

- **Ansible**: Управление конфигурацией и развертывание приложений на множество серверов.
- **GitHub**: Платформа для хостинга IT-проектов и их совместной разработки.
- **Patroni**: Управление кластером PostgreSQL, обеспечивающее высокую доступность и автоматическое переключение на резервный сервер.
- **Etcd**: Надежное хранилище конфигурационных данных кластера.
- **HAProxy**: Балансировка нагрузки между узлами кластера PostgreSQL.
- **Keepalived**: Обеспечение отказоустойчивого виртуального IP-адреса.

## Компоненты

### 1. Etcd

Etcd используется как распределённое ключ-значение хранилище для хранения конфигурационных данных кластера Patroni.

### 2. Patroni

Patroni управляет кластером PostgreSQL, обеспечивая высокую доступность, автоматическое переключение на резервный сервер в случае сбоя и автоматическую синхронизацию данных.

### 3. HAProxy

HAProxy используется для балансировки нагрузки между узлами кластера PostgreSQL, обеспечивая равномерное распределение запросов и повышение отказоустойчивости.

### 4. Keepalived

Keepalived обеспечивает отказоустойчивый виртуальный IP-адрес, который используется для доступа к кластеру Patroni через HAProxy.

## Структура проекта

### Файлы и директории

- `inventory.ini`: Файл инвентаря Ansible, содержащий информацию о хостах для каждой роли.
- `roles/etcd`: Роль Ansible для установки и настройки Etcd.
- `roles/patroni`: Роль Ansible для установки и настройки Patroni.
- `roles/haproxy`: Роль Ansible для установки и настройки HAProxy.
- `roles/keepalived`: Роль Ansible для установки и настройки Keepalived.
- `site.yml`: Основной плейбук Ansible, который вызывает роли для развертывания всего кластера.

## Установка и настройка

### Шаги установки

#### Etcd

1. Скачивание двоичных файлов Etcd.
2. Развертывание конфигурационного файла.
3. Настройка и запуск сервиса Etcd через systemd.

#### Patroni

1. Установка PostgreSQL.
2. Установка Patroni через pip.
3. Развертывание конфигурационного файла Patroni.
4. Настройка и запуск сервиса Patroni через systemd.

#### HAProxy

1. Установка HAProxy.
2. Развертывание конфигурационного файла HAProxy.
3. Настройка и запуск сервиса HAProxy через systemd.

#### Keepalived

1. Установка Keepalived.
2. Развертывание конфигурационного файла Keepalived.
3. Настройка и запуск сервиса Keepalived через systemd.

## Переменные

Проект использует переменные для настройки конфигурации каждого компонента. Эти переменные можно изменять в соответствующих файлах `defaults/main.yml` для каждой роли.

## Запуск

Для развертывания всего кластера выполните следующую команду:

```sh
ansible-playbook -i inventory.ini site.yml
