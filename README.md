# ansible-postgresql-patroni-haproxy

# Проект по установке и настройке PostgreSQL с использованием Patroni, Etcd, HAProxy и Keepalived

#####  В задании используется ряд иструменнов с открытым исходным кодом :
- [Ansible](https://www.ansible.com/) - Управление конфигурацией и развертывание приложений, на множество серверов.
- [GitHub](https://github.com/olejean/) - GitHub — крупнейший веб-сервис для хостинга IT-проектов и их совместной разработки.


## Описание проекта

Этот проект представляет собой автоматизацию установки и настройки кластера PostgreSQL с высокой доступностью, используя инструменты Patroni, Etcd, HAProxy и Keepalived. Он позволяет развернуть кластер баз данных, который обеспечивает:

- Высокую доступность и автоматическое переключение в случае сбоя (Patroni).
- Надежное хранение конфигурационных данных (Etcd).
- Балансировку нагрузки на уровне приложений (HAProxy).
- Обеспечение отказоустойчивого виртуального IP-адреса (Keepalived).

## Компоненты

### 1. Etcd

Etcd используется как распределённое ключ-значение хранилище для хранения конфигурационных данных кластера Patroni.

### 2. Patroni

Patroni управляет кластером PostgreSQL, обеспечивая высокую доступность, автоматическое переключение на резервный сервер в случае сбоя и автоматическую синхронизацию данных.

### 3. HAProxy

HAProxy используется для балансировки нагрузки между узлами кластера PostgreSQL, обеспечивая равномерное распределение запросов и повышение отказоустойчивости.

### 4. Keepalived

Keepalived обеспечивает отказоустойчивый виртуальный IP-адрес, который используется для доступа к кластеру Patroni через HAProxy.

## Структура проекта

### Файлы и директории

- `inventory.ini`: Файл инвентаря Ansible, содержащий информацию о хостах для каждой роли.
- `roles/etcd`: Роль Ansible для установки и настройки Etcd.
- `roles/patroni`: Роль Ansible для установки и настройки Patroni.
- `roles/haproxy`: Роль Ansible для установки и настройки HAProxy.
- `roles/keepalived`: Роль Ansible для установки и настройки Keepalived.
- `site.yml`: Основной плейбук Ansible, который вызывает роли для развертывания всего кластера.

## Установка и настройка

### Шаги установки

1. **Etcd**
    - Скачивание двоичных файлов Etcd.
    - Развертывание конфигурационного файла.
    - Настройка и запуск сервиса Etcd через systemd.

2. **Patroni**
    - Установка PostgreSQL.
    - Установка Patroni через pip.
    - Развертывание конфигурационного файла Patroni.
    - Настройка и запуск сервиса Patroni через systemd.

3. **HAProxy**
    - Установка HAProxy.
    - Развертывание конфигурационного файла HAProxy.
    - Настройка и запуск сервиса HAProxy через systemd.

4. **Keepalived**
    - Установка Keepalived.
    - Развертывание конфигурационного файла Keepalived.
    - Настройка и запуск сервиса Keepalived через systemd.

### Переменные

Проект использует переменные для настройки конфигурации каждого компонента. Эти переменные можно изменять в соответствующих файлах `defaults/main.yml` для каждой роли.

### Запуск

Для развертывания всего кластера выполните следующую команду:

```bash
ansible-playbook -i inventory.ini project.yml

